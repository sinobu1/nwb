<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"/>
    <title>AI Assistant</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://unpkg.com/swiper@8/swiper-bundle.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/swiper@8/swiper-bundle.min.css"/>
    <style>
        /* –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        :root {
            --bg-main: #101010;
            --bg-card: #1E1E1E;
            --bg-select: #2C2C2E;
            --text-primary: #FFFFFF;
            --text-secondary: #A0A0A0;
            --border-color: #3A3A3C;
            --font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'SF Pro Display', sans-serif;
            --gold-highlight: #d8ab4e;
        }
        
        html, body { position: fixed; inset: 0; overflow: hidden; font-family: var(--font-family); background-color: var(--bg-main); color: var(--text-primary); display: flex; justify-content: center; overscroll-behavior-y: contain; }
        .app-wrapper { width: 100%; max-width: 450px; height: 100%; position: relative; overflow: hidden; display: flex; flex-direction: column; }
        
        .screen { position: absolute; inset: 0; display: flex; flex-direction: column; transition: opacity 0.2s ease-out, visibility 0.2s ease-out; background-color: var(--bg-main); z-index: 10; }
        .screen.active { z-index: 20; }
        .screen:not(.active) { opacity: 0; visibility: hidden; pointer-events: none; }
        #main-screen { flex-grow: 1; }
        #main-content-area { flex-grow: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 3rem 1rem 1rem 1rem; }
        .content-pane { display: none; }
        .content-pane.active { display: block; }
        h1, h2, p { margin: 0; }
        h1 { font-size: 1.875rem; font-weight: 800; }
        h2 { font-size: 1.25rem; font-weight: 700; }
        p.subtitle { font-size: 1rem; color: var(--text-secondary); margin-top: 0.25rem; }
        .swiper-container-wrapper { margin-top: 2rem; }
        .swiper-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .swiper-nav-arrows { display: flex; gap: 0.5rem; }
        .swiper-nav-arrow { width: 32px; height: 32px; background-color: var(--bg-card); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: opacity 0.2s; }
        .swiper-nav-arrow.disabled { opacity: 0.3; cursor: not-allowed; }
        .swiper-slide { width: 200px; height: 130px; cursor: pointer; }
        .tg-card { border-radius: 20px; overflow: hidden; height: 100%; }
        .carousel-card { height: 100%; display: flex; flex-direction: column; justify-content: space-between; padding: 1rem; text-align: left; }
        .card-icon { font-size: 1.75rem; }
        .card-title { font-size: 1rem; font-weight: 700; color: #FFFFFF; }
        .card-description { font-size: 0.875rem; color: #FFFFFF; opacity: 0.85; margin-top: 0.25rem; }
        .palette-1 { background: linear-gradient(45deg, #FF416C, #FF4B2B); }
        .palette-2 { background: linear-gradient(45deg, #12C2E9, #C471ED, #F64F59); }
        .palette-3 { background: linear-gradient(45deg, #00C9FF, #92FE9D); }
        .palette-4 { background: linear-gradient(45deg, #FAD961, #F76B1C); }
        .palette-5 { background: linear-gradient(45deg, #4A00E0, #8E2DE2); }
        .palette-6 { background-color: #2D2D2D; }
        .full-screen-card-list { display: grid; gap: 1rem; margin-top: 1.5rem; }
        .full-screen-card { background-color: var(--bg-card); border-radius: 20px; padding: 1.5rem; display: flex; align-items: center; gap: 1.5rem; cursor: pointer; }
        
        /* –ò–ó–ú–ï–ù–ï–ù–ò–ï: –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ —á–∞—Ç–∞ (.chat-messages, .chat-input-area, .chat-message –∏ —Ç.–¥.) */
        
        .ios-tab-bar { flex-shrink: 0; max-width: 400px; width: calc(100% - 2.5rem); margin: 0 auto 1.25rem auto; display: flex; background: rgba(20,20,20,0.7); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-radius: 24px; padding: 0.5rem; border: 1px solid rgba(255,255,255,0.1); z-index: 100; }
        .tab-item { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-secondary); cursor: pointer; }
        .tab-item.active { color: var(--gold-highlight); }
        .tab-item svg { width: 28px; height: 28px; margin-bottom: 2px; }
        .tab-item span { font-size: 0.625rem; font-weight: 500; }
        
        .ios-card { background-color: var(--bg-card); border-radius: 1rem; padding: 1rem; margin-top: 1.5rem; }
        .profile-header { display: flex; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; }
        .profile-avatar { width: 64px; height: 64px; border-radius: 50%; margin-right: 1rem; background-color: #333; }
        .profile-gems { display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; }

        /* –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è TalkJS –¥–æ–ª–∂–µ–Ω –∑–∞–Ω–∏–º–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
        #talkjs-container {
            flex-grow: 1; /* –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞ –≤—Å—é –≤—ã—Å–æ—Ç—É */
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="app-wrapper">
        <div id="main-screen" class="screen active">
            <div id="main-content-area">
                 <div id="home-content" class="content-pane active">
                    <h1>–ì–ª–∞–≤–Ω–∞—è</h1><p class="subtitle">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º</p>
                    <div class="full-screen-card" style="margin-top: 1.5rem;" onclick="alert('–ü–µ—Ä–µ—Ö–æ–¥ –∫ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π')">
                        <div class="icon" style="font-size: 2rem;">üé®</div><div class="info"><h3>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</h3><p>–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é.</p></div>
                    </div>
                    <div class="swiper-container-wrapper">
                        <div class="swiper-header"><h2>–ê–≥–µ–Ω—Ç—ã</h2><div class="swiper-nav-arrows"><div id="agents-nav-prev" class="swiper-nav-arrow"><svg width="16" viewBox="0 0 16 16"><path d="M10 13L5 8L10 3" stroke="currentColor" stroke-width="2"/></svg></div><div id="agents-nav-next" class="swiper-nav-arrow"><svg width="16" viewBox="0 0 16 16"><path d="M6 13L11 8L6 3" stroke="currentColor" stroke-width="2"/></svg></div></div></div>
                        <div class="swiper" id="agents-swiper"><div class="swiper-wrapper" id="agents-swiper-wrapper"></div></div>
                    </div>
                    <div class="swiper-container-wrapper">
                        <div class="swiper-header"><h2>–ú–æ–¥–µ–ª–∏</h2><div class="swiper-nav-arrows"><div id="models-nav-prev" class="swiper-nav-arrow"><svg width="16" viewBox="0 0 16 16"><path d="M10 13L5 8L10 3" stroke="currentColor" stroke-width="2"/></svg></div><div id="models-nav-next" class="swiper-nav-arrow"><svg width="16" viewBox="0 0 16 16"><path d="M6 13L11 8L6 3" stroke="currentColor" stroke-width="2"/></svg></div></div></div>
                        <div class="swiper" id="models-swiper"><div class="swiper-wrapper" id="models-swiper-wrapper"></div></div>
                    </div>
                </div>
                <div id="tools-content" class="content-pane">
                    <h1>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h1><p class="subtitle">–ü–æ–ª–µ–∑–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –±–∞–∑–µ –ò–ò</p>
                    <div id="tools-list" class="full-screen-card-list"></div>
                </div>
                <div id="profile-content" class="content-pane">
                    <h1>–ü—Ä–æ—Ñ–∏–ª—å</h1><p class="subtitle">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ</p>
                    <div class="ios-card">
                       <div class="profile-header"><img id="profile-avatar-img" alt="Avatar" class="profile-avatar"><div class="profile-info"><h2 id="profile-name"></h2><p id="profile-id"></p></div></div>
                       <div class="profile-gems"><span>üíé –ë–∞–ª–∞–Ω—Å –≥–µ–º–æ–≤</span><span id="gem-balance" style="font-weight:700;">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span></div>
                    </div>
                </div>
            </div>
            <nav class="ios-tab-bar">
                <div class="tab-item active" data-tab="home"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M10 3H4a1 1 0 00-1 1v6a1 1 0 001 1h6a1 1 0 001-1V4a1 1 0 00-1-1zm0 11H4a1 1 0 00-1 1v6a1 1 0 001 1h6a1 1 0 001-1v-6a1 1 0 00-1-1zm11-11h-6a1 1 0 00-1 1v6a1 1 0 001 1h6a1 1 0 001-1V4a1 1 0 00-1-1zm-1 12h-6a1 1 0 00-1 1v6a1 1 0 001 1h6a1 1 0 001-1v-6a1 1 0 00-1-1z"/></svg><span>–ì–ª–∞–≤–Ω–∞—è</span></div>
                <div class="tab-item" data-tab="tools"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M20.71 7.04a1 1 0 000-1.41l-2.34-2.34a1 1 0 00-1.41 0l-1.83 1.83L19.5 9.5l1.21-2.46zM3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/></svg><span>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</span></div>
                <div class="tab-item" data-tab="profile"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 19.2c-2.5 0-4.71-1.28-6-3.2.03-2 4-3.1 6-3.1s5.97 1.1 6 3.1c-1.29 1.92-3.5 3.2-6 3.2zM12 5a3 3 0 110 6 3 3 0 010-6zm0-3a10 10 0 100 20 10 10 0 000-20z"/></svg><span>–ü—Ä–æ—Ñ–∏–ª—å</span></div>
            </nav>
        </div>

        <div id="chat-screen" class="screen">
             <div id="talkjs-container">
                <p style="text-align: center; padding-top: 4rem; color: var(--text-secondary);">–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞...</p>
            </div>
        </div>
        
        </div>
    
<script type="module">
    // –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ü–æ–¥–∫–ª—é—á–∞–µ–º TalkJS SDK
    import Talk from 'https://cdn.skypack.dev/talkjs';

    document.addEventListener('DOMContentLoaded', () => {
        const tg = window.Telegram.WebApp;

        // –î–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç–æ–≤, –º–æ–¥–µ–ª–µ–π –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        const agents = [ { key: "universal_ai_basic", name: "–£–Ω–∏–≤–µ—Ä—Å–∞–ª", icon: "üåç", desc: "–û—Ç–≤–µ—Ç—ã –Ω–∞ –ª—é–±—ã–µ —Ç–µ–º—ã", palette: "palette-5" }, { key: "idea_generator", name: "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π", icon: "üí°", desc: "–ü–æ–º–æ—â—å –≤ –ø–æ–∏—Å–∫–µ –∏–¥–µ–π", palette: "palette-4" }, { key: "career_coach", name: "–ö–∞—Ä—å–µ—Ä–Ω—ã–π –∫–æ—É—á", icon: "üìà", desc: "–°–æ–≤–µ—Ç—ã –ø–æ –∫–∞—Ä—å–µ—Ä–µ", palette: "palette-3" }];
        const models = [ { key: "google_gemini_2_0_flash", name: "Gemini 2.0", icon: "‚ö°Ô∏è", desc: "–ë—ã—Å—Ç—Ä–∞—è –∏ –¥–æ—Å—Ç—É–ø–Ω–∞—è", palette: "palette-6" }, { key: "google_gemini_2_5_flash_preview", name: "Gemini 2.5 Flash", icon: "‚ú®", desc: "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –º–æ–¥–µ–ª—å", palette: "palette-1" }];
        const tools = [ { key: "text_analyzer", name: "–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Ç–µ–∫—Å—Ç–∞", icon: "üîç", desc: "–ê–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤." }, { key: "translator_pro", name: "–ü—Ä–æ-–ø–µ—Ä–µ–≤–æ–¥—á–∏–∫", icon: "üåê", desc: "–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ —Ä–µ—á–∏." }];

        let selectedAgentKey = agents[0].key;
        let selectedModelKey = models[0].key; // –≠—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –¥–ª—è –ª–æ–≥–∏–∫–∏
        let agentsSwiper, modelsSwiper;
        let chatbox; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ —á–∞—Ç–∞ TalkJS

        const mainScreen = document.getElementById('main-screen');
        const chatScreen = document.getElementById('chat-screen');

        function switchScreen(screenToShow) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            screenToShow.classList.add('active');
        }

        function showTab(tabId) {
            document.querySelectorAll('.content-pane').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            document.getElementById(`${tabId}-content`).classList.add('active');
            document.querySelector(`.tab-item[data-tab="${tabId}"]`).classList.add('active');
        }
        
        // --- –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –ª–æ–≥–∏–∫–∏ —á–∞—Ç–∞ –Ω–∞ TalkJS ---

        async function openChat() {
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω —á–∞—Ç–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
            switchScreen(chatScreen);
            tg.BackButton.show();

            try {
                // –ñ–¥–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ TalkJS
                await Talk.ready;

                const user = tg.initDataUnsafe?.user;
                if (!user) {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
                    document.getElementById('talkjs-container').innerHTML = '<p>–ù–µ —É–¥–∞–ª–æ—Å—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</p>';
                    return;
                }

                // 1. –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –¥–∞–Ω–Ω—ã—Ö Telegram. –≠—Ç–æ –±—É–¥–µ—Ç —Ç–µ–∫—É—â–∏–π —é–∑–µ—Ä.
                const me = new Talk.User({
                    id: user.id.toString(), // ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π
                    name: `${user.first_name || ''} ${user.last_name || ''}`.trim() || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    photoUrl: user.photo_url,
                    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è
                    custom: {
                        username: user.username,
                    }
                });

                // 2. –°–æ–∑–¥–∞–µ–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ (–±–æ—Ç–∞/–∞–≥–µ–Ω—Ç–∞). –ï–≥–æ ID –∏ –∏–º—è –±–µ—Ä–µ–º –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞.
                const selectedAgent = agents.find(a => a.key === selectedAgentKey);
                const other = new Talk.User({
                    id: selectedAgent.key,
                    name: selectedAgent.name,
                    photoUrl: `https://via.placeholder.com/150/FFFFFF/000000?text=${selectedAgent.icon}`, // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É –∏–∑ –∏–∫–æ–Ω–∫–∏
                    role: "agent", // –£–∫–∞–∑—ã–≤–∞–µ–º —Ä–æ–ª—å
                    welcomeMessage: `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø ${selectedAgent.name}. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?` // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                });

                // 3. –°–æ–∑–¥–∞–µ–º —Å–µ—Å—Å–∏—é –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const session = new Talk.Session({
                    appId: 'tvv2Rb7x', // <-- –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® APP ID –ò–ó –õ–ò–ß–ù–û–ì–û –ö–ê–ë–ò–ù–ï–¢–ê TALKJS
                    me: me
                });

                // 4. –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –ø–æ–ª—É—á–∞–µ–º –±–µ—Å–µ–¥—É –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –∞–≥–µ–Ω—Ç–æ–º
                const conversation = session.getOrCreateConversation(Talk.oneOnOneId(me, other));
                conversation.setParticipant(me);
                conversation.setParticipant(other);
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è —á–∞—Ç–∞
                conversation.setAttributes({
                    subject: `${selectedAgent.icon} ${selectedAgent.name}`
                });

                // 5. –°–æ–∑–¥–∞–µ–º –∏ –º–æ–Ω—Ç–∏—Ä—É–µ–º UI —á–∞—Ç–∞ –≤ –Ω–∞—à –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                // –ï—Å–ª–∏ chatbox —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —É–Ω–∏—á—Ç–æ–∂–∞–µ–º –µ–≥–æ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ
                if (chatbox) {
                    chatbox.destroy();
                }
                chatbox = session.createChatbox(conversation);
                chatbox.mount(document.getElementById('talkjs-container'));

            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TalkJS:", e);
                document.getElementById('talkjs-container').innerHTML = '<p>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —á–∞—Ç–∞.</p>';
            }
        }

        function closeChat() {
            // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä —á–∞—Ç–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏, —á—Ç–æ–±—ã –æ—Å–≤–æ–±–æ–¥–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã
            if (chatbox) {
                chatbox.destroy();
                chatbox = null;
            }
            switchScreen(mainScreen);
            tg.BackButton.hide();
        }
        
        // --- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è UI (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
        function populateCarousel(containerId, items, type) { const wrapper = document.getElementById(containerId); if (!wrapper) return; wrapper.innerHTML = ''; items.forEach(item => { const slide = document.createElement('div'); slide.className = 'swiper-slide'; slide.innerHTML = `<div class="tg-card"><div class="carousel-card ${item.palette}"><div class="card-icon">${item.icon}</div><div><h3 class="card-title">${item.name}</h3><p class="card-description">${item.desc}</p></div></div></div>`; slide.addEventListener('click', () => { if (type === 'agent') selectedAgentKey = item.key; if (type === 'model') selectedModelKey = item.key; openChat(); }); wrapper.appendChild(slide); }); }
        function populateToolsList() { const list = document.getElementById('tools-list'); if (!list) return; list.innerHTML = ''; tools.forEach(item => { const card = document.createElement('div'); card.className = 'full-screen-card'; card.innerHTML = `<div class="icon" style="font-size: 2rem;">${item.icon}</div><div class="info"><h3>${item.name}</h3><p>${item.desc}</p></div>`; list.appendChild(card); }); }
        function displayProfileData() { try { const user = tg.initDataUnsafe?.user; if (!user || !user.id) throw new Error("User data not found"); document.getElementById('profile-avatar-img').src = user.photo_url || 'https://via.placeholder.com/64'; document.getElementById('profile-name').textContent = `${user.first_name || ''} ${user.last_name || ''}`.trim() || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'; document.getElementById('profile-id').textContent = `ID: ${user.id}`; } catch (e) { document.getElementById('profile-name').textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'; document.getElementById('profile-id').textContent = 'ID: –ù/–î'; } }
        function updateNavArrows(swiper, prefix) { const prev = document.getElementById(`${prefix}-nav-prev`); const next = document.getElementById(`${prefix}-nav-next`); if(prev && next) { prev.classList.toggle('disabled', swiper.isBeginning); next.classList.toggle('disabled', swiper.isEnd); } }

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ---
        function init() {
            tg.ready();
            tg.expand();
            tg.BackButton.onClick(closeChat);
            
            populateCarousel('agents-swiper-wrapper', agents, 'agent');
            populateCarousel('models-swiper-wrapper', models, 'model');
            populateToolsList();
            displayProfileData();
            
            agentsSwiper = new Swiper("#agents-swiper", { slidesPerView: 'auto', spaceBetween: 12, on: { init(s){ updateNavArrows(s, 'agents') }, slideChange(s){ updateNavArrows(s, 'agents') } }});
            modelsSwiper = new Swiper("#models-swiper", { slidesPerView: 'auto', spaceBetween: 12, on: { init(s){ updateNavArrows(s, 'models') }, slideChange(s){ updateNavArrows(s, 'models') } }});
            
            document.querySelectorAll('.tab-item').forEach(tab => tab.addEventListener('click', () => showTab(tab.dataset.tab)));
            document.getElementById('agents-nav-prev').addEventListener('click', () => agentsSwiper.slidePrev());
            document.getElementById('agents-nav-next').addEventListener('click', () => agentsSwiper.slideNext());
            document.getElementById('models-nav-prev').addEventListener('click', () => modelsSwiper.slidePrev());
            document.getElementById('models-nav-next').addEventListener('click', () => modelsSwiper.slideNext());

            // –í—Å–µ —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —á–∞—Ç–∞ —É–¥–∞–ª–µ–Ω—ã, —Ç–∞–∫ –∫–∞–∫ TalkJS –±–µ—Ä–µ—Ç —ç—Ç–æ –Ω–∞ —Å–µ–±—è
        }

        init();
    });
</script>
</body>
</html>
