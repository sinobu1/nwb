<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"/>
    <title>AI Assistant</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://unpkg.com/swiper@8/swiper-bundle.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/swiper@8/swiper-bundle.min.css"/>
    <style>
        :root {
            --bg-main: #101010;
            --bg-card: #1E1E1E;
            --bg-select: #2C2C2E;
            --text-primary: #FFFFFF;
            --text-secondary: #A0A0A0;
            --border-color: #3A3A3C;
            --font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'SF Pro Display', sans-serif;
            --gold-gradient: linear-gradient(135deg, #f7d06b, #d8ab4e);
            --gold-highlight: #d8ab4e;
            --text-accent: var(--gold-highlight);
        }
        
        html, body {
            position: fixed; inset: 0; overflow: hidden;
            font-family: var(--font-family);
            background-color: var(--bg-main);
            color: var(--text-primary);
            display: flex; justify-content: center;
            overscroll-behavior-y: contain;
        }

        .app-wrapper { width: 100%; max-width: 450px; height: 100%; position: relative; overflow: hidden; display: flex; flex-direction: column; }
        .app-container { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; }
        
        .scrollable-content {
            flex-grow: 1; overflow-y: auto; overflow-x: hidden;
            -webkit-overflow-scrolling: touch; padding-bottom: 120px;
        }
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
        .scrollable-content::-webkit-scrollbar { width: 5px; }
        .scrollable-content::-webkit-scrollbar-track { background: transparent; }
        .scrollable-content::-webkit-scrollbar-thumb { background-color: #444; border-radius: 10px; border: 2px solid transparent; }
        .scrollable-content::-webkit-scrollbar-thumb:hover { background-color: #555; }

        .content-wrapper { padding: 0 1rem; }
        
        h1 { font-size: 1.875rem; font-weight: 800; }
        h2 { font-size: 1.25rem; font-weight: 700; }
        p.subtitle { font-size: 1rem; color: var(--text-secondary); }

        /* –°—Ç–∏–ª–∏ –∫–∞—Ä—É—Å–µ–ª–∏ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .swiper-container-wrapper { margin-top: 2rem; position: relative; }
        .swiper-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0 1rem; }
        .swiper-nav-arrows { display: flex; gap: 0.5rem; }
        .swiper-nav-arrow { width: 32px; height: 32px; background-color: var(--bg-card); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-primary); transition: background-color 0.2s, opacity 0.2s; }
        .swiper-nav-arrow:hover { background-color: #333; }
        .swiper-nav-arrow.disabled { opacity: 0.3; cursor: not-allowed; pointer-events: none; }
        .swiper { width: 100%; overflow: visible; padding: 0 1rem; box-sizing: border-box; }
        .swiper-slide { width: 200px; height: 130px; cursor: pointer; }
        .tg-card.tg-card-selected { padding: 3px; background: var(--gold-gradient); box-shadow: 0 10px 30px rgba(216, 171, 78, 0.4); }
        .tg-card.tg-card-selected .carousel-card-inner { background-color: var(--bg-card); height: 100%; border-radius: 17px; }
        .tg-card { transition: transform 0.25s, box-shadow 0.25s; border-radius: 20px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.25); height: 100%; }
        .carousel-card { height: 100%; display: flex; flex-direction: column; justify-content: space-between; padding: 1rem; text-align: left; border-radius: 20px; }
        
        .palette-1 { background: linear-gradient(45deg, #FF416C, #FF4B2B); }
        .palette-2 { background: linear-gradient(45deg, #12C2E9, #C471ED, #F64F59); }
        .palette-3 { background: linear-gradient(45deg, #00C9FF, #92FE9D); }
        .palette-4 { background: linear-gradient(45deg, #FAD961, #F76B1C); }
        .palette-5 { background: linear-gradient(45deg, #4A00E0, #8E2DE2); }
        .palette-6 { background-color: #2D2D2D; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .full-screen-card-list { display: grid; gap: 1rem; /* –£–≤–µ–ª–∏—á–µ–Ω –æ—Ç—Å—Ç—É–ø */ margin-top: 1.5rem; }
        .full-screen-card { background-color: var(--bg-card); border-radius: 20px; padding: 1.5rem; display: flex; align-items: center; gap: 1.5rem; cursor: pointer; transition: background-color 0.2s ease; border: 1px solid var(--border-color); }
        .full-screen-card:hover { background-color: #2c2c2e; }
        .full-screen-card .icon { font-size: 2.5rem; flex-shrink: 0; }
        .full-screen-card .info h3 { font-size: 1.125rem; font-weight: 700; margin: 0; color: var(--text-primary); }
        .full-screen-card .info p { font-size: 0.9rem; color: var(--text-secondary); margin: 0.25rem 0 0 0; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—ã–±–æ—Ä–∞ */
        .selection-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin-top: 1.5rem; }
        .selection-container { background-color: var(--bg-card); border-radius: 1rem; padding: 1rem; }
        .selection-container label { font-weight: 600; color: var(--text-secondary); font-size: 0.875rem; }
        .select-wrapper { position: relative; margin-top: 0.75rem; }
        .custom-select { -webkit-appearance: none; -moz-appearance: none; appearance: none; width: 100%; background-color: var(--bg-select); color: var(--text-primary); padding: 0.75rem 2.5rem 0.75rem 1rem; border-radius: 0.5rem; border: 1px solid var(--border-color); font-size: 1rem; font-weight: 500; cursor: pointer; }
        .select-wrapper::after { content: '‚åÑ'; font-size: 1.5rem; color: var(--text-secondary); position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); pointer-events: none; }

        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –∏ —Ç–∞–±-–±–∞—Ä–∞ */
        .ios-tab-bar { position: absolute; bottom: 1.25rem; left: 50%; transform: translateX(-50%); width: calc(100% - 2.5rem); max-width: 400px; display: flex; background: rgba(20, 20, 20, 0.7); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-radius: 24px; padding: 0.5rem; z-index: 100; border: 1px solid rgba(255,255,255,0.1); }
        .tab-item { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-secondary); cursor: pointer; transition: color 0.2s ease; -webkit-tap-highlight-color: transparent; }
        .tab-item.active { color: var(--text-accent); }
        .tab-item svg { width: 28px; height: 28px; margin-bottom: 2px; }
        .tab-item span { font-size: 0.625rem; font-weight: 500; }
        .page { display: none; padding-top: 3rem; }
        .page.active { display: block; }
        .ios-card { background-color: var(--bg-card); border-radius: 1rem; padding: 1rem; margin-top: 1.5rem; }
        .profile-header { display: flex; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; }
        .profile-avatar { width: 64px; height: 64px; border-radius: 50%; margin-right: 1rem; object-fit: cover; background-color: #333; }
        .profile-info h2 { font-size: 1.25rem; font-weight: 700; }
        .profile-info p { font-size: 0.9rem; }
        .profile-gems { display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; }
        .profile-gems .label { font-weight: 500; color: var(--text-secondary); }
        .profile-gems .value { font-weight: 700; font-size: 1.1rem; color: var(--text-accent); }
        #debug-info { display: none; }
    </style>
</head>
<body>
    <div class="app-wrapper">
        <div id="debug-info"></div>
        <div class="app-container">
            <div class="scrollable-content">
                
                <div id="home-page" class="page active">
                    <div class="content-wrapper">
                        <div class="mb-8">
                            <h1>–ì–ª–∞–≤–Ω–∞—è</h1>
                            <p class="subtitle">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º</p>
                        </div>
                         <div class="full-screen-card" id="image-generator-card">
                            <div class="icon">üé®</div>
                            <div class="info">
                                <h3>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</h3>
                                <p>–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –ø–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é.</p>
                            </div>
                        </div>
                    </div>
                    <div class="swiper-container-wrapper">
                        <div class="swiper-header">
                            <h2>–ê–≥–µ–Ω—Ç—ã</h2>
                            <div class="swiper-nav-arrows">
                                <div id="agents-nav-prev" class="swiper-nav-arrow disabled"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 13L5 8L10 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
                                <div id="agents-nav-next" class="swiper-nav-arrow"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 13L11 8L6 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
                            </div>
                        </div>
                        <div class="swiper" id="agents-swiper"><div class="swiper-wrapper" id="agents-swiper-wrapper"></div></div>
                    </div>
                    <div class="swiper-container-wrapper">
                         <div class="swiper-header">
                            <h2>–ú–æ–¥–µ–ª–∏</h2>
                            <div class="swiper-nav-arrows">
                                <div id="models-nav-prev" class="swiper-nav-arrow disabled"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 13L5 8L10 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
                                <div id="models-nav-next" class="swiper-nav-arrow"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 13L11 8L6 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
                            </div>
                        </div>
                        <div class="swiper" id="models-swiper"><div class="swiper-wrapper" id="models-swiper-wrapper"></div></div>
                    </div>
                </div>

                <div id="tools-page" class="page">
                    <div class="content-wrapper">
                        <div class="mb-8">
                            <h1>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h1>
                            <p class="subtitle">–ü–æ–ª–µ–∑–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –±–∞–∑–µ –ò–ò</p>
                        </div>
                        <div id="tools-list" class="full-screen-card-list"></div>
                    </div>
                </div>
                
                <div id="profile-page" class="page">
                    <div class="content-wrapper">
                        <div class="mb-8">
                            <h1>–ü—Ä–æ—Ñ–∏–ª—å</h1>
                            <p class="subtitle">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ</p>
                        </div>
                        <div class="ios-card">
                           <div class="profile-header">
                                <img id="profile-avatar-img" src="" alt="Avatar" class="profile-avatar" onerror="this.src='https://via.placeholder.com/64';">
                                <div class="profile-info">
                                    <h2 id="profile-name">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
                                    <p id="profile-id">ID: –ù/–î</p>
                                </div>
                            </div>
                            <div class="profile-gems">
                                <span class="label">üíé –ë–∞–ª–∞–Ω—Å –≥–µ–º–æ–≤</span>
                                <span id="gem-balance" class="value">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="selection-page" class="page">
                    <div class="content-wrapper">
                        <div class="mb-8">
                            <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
                            <p class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –∏ –º–æ–¥–µ–ª—å</p>
                        </div>
                        <div class="selection-grid">
                            <div class="selection-container">
                                <label for="agent-select">–ê–ö–¢–ò–í–ù–´–ô –ê–ì–ï–ù–¢</label>
                                <div class="select-wrapper">
                                    <select id="agent-select" class="custom-select"></select>
                                </div>
                            </div>
                            <div class="selection-container">
                                <label for="model-select">–ê–ö–¢–ò–í–ù–ê–Ø –ú–û–î–ï–õ–¨</label>
                                <div class="select-wrapper">
                                    <select id="model-select" class="custom-select"></select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            
            <nav class="ios-tab-bar">
                <div class="tab-item active" id="tab-home">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M10 3H4C3.45 3 3 3.45 3 4v6c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1zm0 11H4c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-6c0-.55-.45-1-1-1zm11-11h-6c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1zm-5 12c.55 0 1 .45 1 1v6c0 .55-.45 1-1 1h-6c-.55 0-1-.45-1-1v-6c0-.55.45-1 1-1h6z"/></svg>
                    <span>–ì–ª–∞–≤–Ω–∞—è</span>
                </div>
                <div class="tab-item" id="tab-tools">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83L19.5 9.5l1.21-2.46zM3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM5.92 19H5v-.92l9.06-9.06.92.92L5.92 19z"/></svg>
                    <span>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</span>
                </div>
                <div class="tab-item" id="tab-profile">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12,19.2C9.5,19.2 7.29,17.92 6,16C6.03,14 10,12.9 12,12.9C14,12.9 17.97,14 18,16C16.71,17.92 14.5,19.2 12,19.2M12,5A3,3 0 0,1 15,8A3,3 0 0,1 12,11A3,3 0 0,1 9,8A3,3 0 0,1 12,5M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" /></svg>
                    <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
                </div>
            </nav>
        </div>
    </div>
    
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const tg = window.Telegram.WebApp;

        // --- –î–ê–ù–ù–´–ï ---
        const agents = [ { key: "universal_ai_basic", name: "–£–Ω–∏–≤–µ—Ä—Å–∞–ª", icon: "üåç", desc: "–û—Ç–≤–µ—Ç—ã –Ω–∞ –ª—é–±—ã–µ —Ç–µ–º—ã", palette: "palette-5" }, { key: "idea_generator", name: "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π", icon: "üí°", desc: "–ü–æ–º–æ—â—å –≤ –ø–æ–∏—Å–∫–µ –∏–¥–µ–π", palette: "palette-4" }, { key: "career_coach", name: "–ö–∞—Ä—å–µ—Ä–Ω—ã–π –∫–æ—É—á", icon: "üìà", desc: "–°–æ–≤–µ—Ç—ã –ø–æ –∫–∞—Ä—å–µ—Ä–µ", palette: "palette-3" }, { key: "programming_partner", name: "–ü–∞—Ä—Ç–Ω–µ—Ä-–ø—Ä–æ–≥–µ—Ä", icon: "üíª", desc: "–ü–æ–º–æ—â—å –≤ –∫–æ–¥–µ", palette: "palette-2" }, { key: "tutor_assistant", name: "–†–µ–ø–µ—Ç–∏—Ç–æ—Ä", icon: "üìö", desc: "–ü–æ–º–æ—â—å —Å —É—á–µ–±–æ–π", palette: "palette-1" }, { key: "literary_editor", name: "–†–µ–¥–∞–∫—Ç–æ—Ä", icon: "‚úçÔ∏è", desc: "–£–ª—É—á—à–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤", palette: "palette-6" } ];
        const models = [ { key: "google_gemini_2_0_flash", name: "Gemini 2.0", icon: "G", desc: "–ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å", palette: "palette-6" }, { key: "google_gemini_2_5_flash_preview", name: "Gemini 2.5 Flash", icon: "G+", desc: "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è", palette: "palette-1" }, { key: "custom_api_gemini_2_5_pro", name: "Gemini Pro", icon: "G Pro", desc: "–ú–æ—â–Ω–∞—è –º–æ–¥–µ–ª—å", palette: "palette-5" }, { key: "custom_api_grok_3", name: "Grok 3", icon: "X", desc: "–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞", palette: "palette-2" }, { key: "custom_api_gpt_4o_mini", name: "GPT-4o mini", icon: "O", desc: "–ë—ã—Å—Ç—Ä–∞—è –∏ –Ω–µ–¥–æ—Ä–æ–≥–∞—è", palette: "palette-3" } ];
        const tools = [ { key: "text_analyzer", name: "–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Ç–µ–∫—Å—Ç–∞", icon: "üîç", desc: "–ê–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤." }, { key: "translator_pro", name: "–ü—Ä–æ-–ø–µ—Ä–µ–≤–æ–¥—á–∏–∫", icon: "üåê", desc: "–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ —Ä–µ—á–∏." }, { key: "summarizer", name: "–°—É–º–º–∞—Ä–∏–∑–∞—Ç–æ—Ä", icon: "üìë", desc: "–ö—Ä–∞—Ç–∫–∏–π –ø–µ—Ä–µ—Å–∫–∞–∑ –¥–ª–∏–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π –∏ –≤–∏–¥–µ–æ." } ];

        // --- –°–û–°–¢–û–Ø–ù–ò–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ---
        let selectedAgentKey = agents[0].key;
        let selectedModelKey = models[0].key;
        let agentsSwiper, modelsSwiper;

        // --- DOM –≠–õ–ï–ú–ï–ù–¢–´ ---
        const agentSelect = document.getElementById('agent-select');
        const modelSelect = document.getElementById('model-select');

        // --- –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ---
        function sendDataToBot(action, target) {
            if (tg.initData) {
                tg.sendData(JSON.stringify({ action, target }));
                tg.HapticFeedback.notificationOccurred('success');
            }
        }
        
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            const page = document.getElementById(pageId);
            if(page) page.classList.add('active');
            const tab = document.getElementById(`tab-${pageId.replace('-page','')}`);
            if(tab) tab.classList.add('active');
        }
        
        // --- –õ–û–ì–ò–ö–ê –°–¢–†–ê–ù–ò–¶–´ –í–´–ë–û–†–ê –ò –ù–ê–í–ò–ì–ê–¶–ò–ò ---
        function openSelectionPage() {
            populateSelectionDropdowns();
            showPage('selection-page');
            tg.BackButton.show();
        }

        function closeSelectionPage() {
            showPage('home-page');
            updateHomeSelectionVisuals();
            tg.BackButton.hide();
        }

        function populateSelectionDropdowns() {
            agentSelect.innerHTML = '';
            modelSelect.innerHTML = ''; // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –æ—á–∏—â–∞–µ–º –æ–±–∞ —Å–ø–∏—Å–∫–∞
            
            agents.forEach(a => agentSelect.appendChild(new Option(`${a.icon} ${a.name}`, a.key)));
            models.forEach(m => modelSelect.appendChild(new Option(`${m.name}`, m.key)));
            
            agentSelect.value = selectedAgentKey;
            modelSelect.value = selectedModelKey;
        }

        function updateHomeSelectionVisuals() {
            document.querySelectorAll('.swiper-slide .tg-card').forEach(c => c.classList.remove('tg-card-selected'));
            const selectedAgentCard = document.querySelector(`#agents-swiper .swiper-slide[data-key="${selectedAgentKey}"] .tg-card`);
            if (selectedAgentCard) selectedAgentCard.classList.add('tg-card-selected');
            const selectedModelCard = document.querySelector(`#models-swiper .swiper-slide[data-key="${selectedModelKey}"] .tg-card`);
            if (selectedModelCard) selectedModelCard.classList.add('tg-card-selected');
        }

        function updateNavArrows(swiper, prefix) {
            const prev = document.getElementById(`${prefix}-nav-prev`);
            const next = document.getElementById(`${prefix}-nav-next`);
            if (prev && next) {
                prev.classList.toggle('disabled', swiper.isBeginning);
                next.classList.toggle('disabled', swiper.isEnd);
            }
        }

        // --- –ó–ê–ü–û–õ–ù–ï–ù–ò–ï –ö–û–ù–¢–ï–ù–¢–ê ---
        function populateCarousel(containerId, items, type) {
            const wrapper = document.getElementById(containerId);
            if (!wrapper) return;
            wrapper.innerHTML = '';
            items.forEach(item => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                slide.dataset.key = item.key;
                slide.innerHTML = `<div class="tg-card"><div class="carousel-card-inner carousel-card ${item.palette}"><div class="card-icon">${item.icon || ''}</div><div><h3 class="card-title">${item.name}</h3><p class="card-description mt-1">${item.desc}</p></div></div></div>`;
                slide.addEventListener('click', () => {
                    if (type === 'agent') selectedAgentKey = item.key;
                    if (type === 'model') selectedModelKey = item.key;
                    openSelectionPage();
                });
                wrapper.appendChild(slide);
            });
        }

        function populateToolsList() {
            const list = document.getElementById('tools-list');
            if (!list) return;
            list.innerHTML = '';
            tools.forEach(item => {
                const card = document.createElement('div');
                card.className = 'full-screen-card';
                card.innerHTML = `<div class="icon">${item.icon}</div><div class="info"><h3>${item.name}</h3><p>${item.desc}</p></div>`;
                list.appendChild(card);
            });
        }
        
        function displayProfileData() {
            try {
                const user = tg.initDataUnsafe?.user;
                if (user && user.id) {
                    document.getElementById('profile-avatar-img').src = user.photo_url || 'https://via.placeholder.com/64';
                    const fullName = `${user.first_name || ''} ${user.last_name || ''}`.trim();
                    document.getElementById('profile-name').textContent = fullName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                    document.getElementById('profile-id').textContent = `ID: ${user.id}`;
                } else { throw new Error("User data not found"); }
            } catch (e) {
                console.error("Profile data error:", e);
                document.getElementById('profile-name').textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                document.getElementById('profile-id').textContent = 'ID: –ù/–î';
            }
        }

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ---
        function init() {
            tg.ready();
            tg.expand();
            tg.BackButton.onClick(closeSelectionPage);
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ "—Å–ø–æ–ª–∑–∞–Ω–∏—è" –æ–∫–Ω–∞
            document.body.addEventListener('touchmove', (e) => {
                if (!e.target.closest('.scrollable-content')) {
                    e.preventDefault();
                }
            }, { passive: false });

            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            populateCarousel('agents-swiper-wrapper', agents, 'agent');
            populateCarousel('models-swiper-wrapper', models, 'model');
            populateToolsList();
            displayProfileData();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Swiper
            agentsSwiper = new Swiper("#agents-swiper", { slidesPerView: 'auto', spaceBetween: 16, on: { init(s){ updateNavArrows(s, 'agents') }, slideChange(s){ updateNavArrows(s, 'agents') } }});
            modelsSwiper = new Swiper("#models-swiper", { slidesPerView: 'auto', spaceBetween: 16, on: { init(s){ updateNavArrows(s, 'models') }, slideChange(s){ updateNavArrows(s, 'models') } }});
            
            updateHomeSelectionVisuals();
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è
            document.getElementById('tab-home').addEventListener('click', () => showPage('home-page'));
            document.getElementById('tab-tools').addEventListener('click', () => showPage('tools-page'));
            document.getElementById('tab-profile').addEventListener('click', () => showPage('profile-page'));

            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è —Å—Ç—Ä–µ–ª–æ–∫ –∫–∞—Ä—É—Å–µ–ª–∏
            document.getElementById('agents-nav-prev').addEventListener('click', () => agentsSwiper.slidePrev());
            document.getElementById('agents-nav-next').addEventListener('click', () => agentsSwiper.slideNext());
            document.getElementById('models-nav-prev').addEventListener('click', () => modelsSwiper.slidePrev());
            document.getElementById('models-nav-next').addEventListener('click', () => modelsSwiper.slideNext());

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤
            agentSelect.addEventListener('change', (e) => { selectedAgentKey = e.target.value; sendDataToBot('set_agent', selectedAgentKey); });
            modelSelect.addEventListener('change', (e) => { selectedModelKey = e.target.value; sendDataToBot('set_model', selectedModelKey); });
        }

        init();
    });
</script>
</body>
</html>
